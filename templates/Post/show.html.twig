{% extends 'base.html.twig' %}

{% block title %}{{ post.title }}{% endblock %}

{% block body %}
    <div class="container mt-4">
        <div class="row">
            <div class="col-md-8 offset-md-2">
                <h1>{{ post.title }}</h1>
                <p>{{ post.content }}</p>

                {% if post.categories is not empty %}
                    <h3>Kategorie:</h3>
                    <ul>
                        {% for category in post.categories %}
                            <li>{{ category.name }}</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>Brak kategorii przypisanych do tego posta.</p>
                {% endif %}

                <h3>Komentarze:</h3>
                <ul>
                    {% for comment in post.comments %}
                        <li>
                            <strong>{{ comment.nick }}</strong> ({{ comment.email }}): {{ comment.content }}
                            {% if is_granted('ROLE_ADMIN') %}
                                <form method="post" action="{{ path('comment_delete', {'id': comment.id}) }}" onsubmit="return confirm('Czy na pewno chcesz usunąć ten komentarz?');" style="display:inline-block;">
                                    <input type="hidden" name="_token" value="{{ csrf_token('delete-comment' ~ comment.id) }}">
                                    <button class="btn btn-danger btn-sm" type="submit">Usuń</button>
                                </form>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>

                <h3>Dodaj Komentarz:</h3>
                {{ form_start(commentForm) }}
                {{ form_row(commentForm.nick, {'label': 'Nick'}) }}
                {{ form_row(commentForm.email, {'label': 'Email'}) }}
                {{ form_row(commentForm.content, {'label': 'Treść'}) }}
                <button class="btn btn-primary" type="submit">Dodaj Komentarz</button>
                {{ form_end(commentForm) }}

                <hr>
                {% if is_granted('ROLE_ADMIN') %}
                    <a href="{{ path('post_edit', {'id': post.id}) }}" class="btn btn-secondary">Edytuj</a>
                {% endif %}

                {% if is_granted('ROLE_ADMIN') %}
                    <form method="post" action="{{ path('post_delete', {'id': post.id}) }}" onsubmit="return confirm('Czy na pewno chcesz usunąć ten post?');" style="display:inline-block;">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete-post' ~ post.id) }}">
                        <button class="btn btn-danger" type="submit">Usuń</button>
                    </form>
                {% endif %}
                <a href="{{ path('main_page') }}" class="btn btn-primary">Powrót do listy</a>
            </div>
        </div>
    </div>
{% endblock %}
